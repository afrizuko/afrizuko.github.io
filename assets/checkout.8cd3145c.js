import{Q}from"./QSeparator.a8629110.js";import{Q as _}from"./QSpace.5bfa4d1e.js";import{_ as ce,d as me,r as R,aV as ve,u as pe,af as ye,v as _e,c as i,o as fe,y as p,E as x,f as a,A as r,F as L,B as t,q as he,I as n,K as g,Q as v,aC as xe,D as G,G as ge,J as b,C as f,z as W,ay as be,L as qe,M as we}from"./index.7946e59e.js";import{Q as J,d as Pe}from"./QDate.c58f60b9.js";import{Q as K}from"./QMenu.93398c35.js";import{Q as q}from"./QCard.924445d0.js";import{Q as Ce}from"./use-dark.ad276966.js";import{Q as De}from"./QSelect.c8b63812.js";import{Q as w}from"./QInput.64d2180c.js";import{Q as Z}from"./QRadio.60c3e0a4.js";import{Q as Ve}from"./QPopupProxy.8bbcfd87.js";import{Q as Me}from"./QForm.3b99a435.js";import{Q as U}from"./QCardSection.4ae97256.js";import{Q as Ie}from"./QCheckbox.907f0d66.js";import{Q as Se}from"./QPage.1d57e43e.js";import{Q as Qe}from"./QDialog.b2d083ec.js";import{u as ke}from"./payment.aa3e46aa.js";import{m as X}from"./moment.18ddbc39.js";import{u as Oe}from"./property.7bf9bb4b.js";import"./use-cache.b0833c75.js";import"./use-form.5abd52b8.js";import"./format.c860d4da.js";import"./position-engine.c6d63749.js";import"./use-timeout.ea9f6b03.js";import"./focus-manager.b507780d.js";import"./scroll.2482edc2.js";import"./use-prevent-scroll.7f51476a.js";import"./QChip.94127689.js";import"./QItem.3413e48f.js";import"./rtl.b51694b1.js";import"./uid.42677368.js";import"./use-checkbox.e60cbcce.js";const d=D=>(qe("data-v-c063206e"),D=D(),we(),D),Ae={class:"row justify-between q-mt-xl"},$e=d(()=>t("div",{class:"row"},[t("h1",{class:"text-weight-bold text-h4"}," Confirm and payment ")],-1)),Ee={class:"row"},Re=d(()=>t("h1",{class:"text-weight-bold text-h5"}," Your Stay ",-1)),Ue={class:"row q-mt-md"},Te={class:"row q-mt-md"},Ne=d(()=>t("div",{class:"text-grey"}," Date ",-1)),ze={class:"text-weight-bold text-h6"},Ye={class:"q-pa-md"},Fe={class:"row q-mt-md"},Be=d(()=>t("div",{class:"text-grey"}," Guests ",-1)),He={class:"text-weight-bold text-h6"},je={class:"row q-mx-md q-my-sm",style:{width:"400px"}},Le=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-6 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[f(" Adults "),t("h1",{class:"text-caption no-margin"},"Ages 13 or above")])],-1)),Ge={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},We={class:"row"},Je={class:"q-mt-sm q-pa-sm"},Ke={class:"row q-mx-md",style:{width:"400px"}},Ze=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[f(" Children "),t("h1",{class:"text-caption no-margin"},"Ages 2-12")])],-1)),Xe={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},et={class:"row"},tt={class:"q-mt-sm q-pa-sm"},ot={class:"row q-mx-md",style:{width:"400px"}},at=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[f(" Infants "),t("h1",{class:"text-caption no-margin"},"Ages 0-2")])],-1)),lt={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},st={class:"row"},nt={class:"q-mt-sm q-pa-sm"},rt=d(()=>t("div",{class:"row"},[t("h1",{class:"text-weight-bold text-h5"}," Pay with ")],-1)),dt={class:"q-mt-md q-px-sm"},it={class:"row"},ut={key:0,class:"row q-my-md"},ct={class:"col-sm-12 col-xs-12 col-lg-6 col-xl-4 col-md-4 q-px-sm"},mt={class:"col-sm-12 col-xs-12 col-lg-6 col-xl-4 col-md-4 q-px-sm"},vt={key:1},pt={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-md"},yt={class:"q-gutter-sm"},_t={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-sm q-px-sm"},ft={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-sm q-px-sm"},ht={class:"col-sm-12 col-xs-12 col-lg-6 col-md-4 q-my-sm q-px-sm"},xt={class:"col-sm-12 col-xs-12 col-lg-6 col-md-4 q-my-sm q-px-sm"},gt={class:"row"},bt={class:"col-sm-12 col-xs-12 col-lg-12 col-xl-8 col-md-4 q-px-sm"},qt={class:"row q-ma-sm"},wt={class:"text-h7 q-mt-sm q-mb-xs text-grey"},Pt={class:"text-h7 q-mt-sm q-mb-xs"},Ct={class:"row justify-between q-mt-md"},Dt={key:0,class:"q-mr-sm"},Vt={class:"q-mt-md"},Mt={class:"text-grey"},It=d(()=>t("div",{class:"row"},[t("div",{class:"text-h5 q-mt-sm q-mb-xs q-ml-md"}," Price detail ")],-1)),St={class:"row q-mx-lg q-mt-md q-mb-sm"},Qt={class:"text-grey"},kt={style:{"font-size":"0.8em",color:"#ff0000"}},Ot={class:"text-grey"},At={class:"row q-mx-lg q-mb-sm"},$t=d(()=>t("div",{class:"text-grey"}," VAT ",-1)),Et={class:"text-grey"},Rt={class:"row q-mx-lg q-mb-md"},Ut=d(()=>t("div",{class:"text-grey"}," Service charge ",-1)),Tt={class:"text-grey"},Nt={class:"row q-mx-lg q-ma-md"},zt=d(()=>t("div",{class:"text-subtitle1"}," Total ",-1)),Yt={class:"text-subtitle1"},Ft={class:"row"},Bt=d(()=>t("div",null,[t("p",{class:"text-h6 text-negative q-mt-sm"}," Transaction Failed ")],-1)),Ht={class:"q-dialog__header"},jt=d(()=>t("div",{class:"row q-mb-md q-pa-md"},[t("p",null,"Whoops! Your transaction didn't go through. Please double-check your payment details and try again")],-1)),Lt=me({__name:"checkout",setup(D){R(null),ve();const ee=pe(),m=ye(),u=ke(),P=Oe(),k=_e(),V=R(!1),T=R("31/12/2023");i(()=>{const l=T.value.split("/"),o=Date.parse(`${l[2]}-${l[1]}-${l[0]}`);return`${T.value} (${o})`});const e=i(()=>u.getPaymentDetails),O=i(()=>e.value.noOfInfants+e.value.noOfChildren+e.value.noOfAdults),h=i(()=>{if(e.value.period.from!=null){const l=X(e.value.period.from);return X(e.value.period.to).diff(l,"months")+1}else return 1});i(()=>P.getPropertyRating),i(()=>P.getImages);const C=i(()=>P.getProperty),te=i(()=>u.isLoading),M=i(()=>u.getResponse),N=i(()=>e.value.paymentMethod=="MobileMoney"),I=i(()=>{var l,o;return(o=P.getPropertyReviews[(l=C.value)==null?void 0:l.id])==null?void 0:o.reviews}),A=l=>l&&l.replace(/[()\s\-]/g,"").length===12||"Phone Number must be 12 characters",oe=l=>l!==null||"Telecom is required",ae=()=>A(e.value.mobilePayment.telecom)&&A(e.value.mobilePayment.phone),z=l=>l&&l.replace(/\s/g,"").length==16||"Card must be 16 characters",Y=l=>l&&l.length!=0||"Card holder name is required",$=l=>l&&l.length!=0||"Description is required",le=l=>l&&l.length==3||"CVC must be 3 characters",F=l=>{const o=Pe.formatDate(new Date,"DD/MM/YYYY");return l&&l>o||"Please select a future date"},se=()=>z(e.value.cardPayment.cardNumber)&&Y(e.value.cardPayment.cardHolder)&&F(e.value.cardPayment.expiryDate)&&$(e.value.description)&&$(e.value.cardPayment.cvc),ne=i(()=>e.value.period.hasOwnProperty("from")?`${m.formatDateMonthDay(e.value.period.from)} -
    ${m.formatDateMonthDay(e.value.period.to)}`:m.formatStartDate(e.value.period));function B(l){u.noOfAdults(l)}function H(l){u.noOfChildren(l)}function j(l){u.noOfInfants(l)}async function re(){var o;let l={objectType:"PROPERTY",objectIds:[(o=e.value)==null?void 0:o.objectId]};await P.findPropertyImages(l)}async function de(){var l,o;if(e.value.paymentMethod=="MobileMoney"?ae():se())if(e.value.paymentMethod==="DebitCard"?(e.value.cardPayment.cardNumber=String((l=e.value.cardPayment.cardNumber)==null?void 0:l.replace(/\s/g,"")),e.value.cardPayment.expiryDate=e.value.cardPayment.expiryDate+"T00:00:00Z"):e.value.mobilePayment.phone=String((o=e.value.mobilePayment.phone)==null?void 0:o.replace(/[()\s\-]/g,"")),e.value.userId=k.currentUser().aud[0],sessionStorage.setItem("tempPay",JSON.stringify(e.value)),e.value.paymentMethod==="DebitCard"?delete e.value.mobilePayment:delete e.value.cardPayment,await u.reserveProperty(String(e.value.objectId),{tenantId:k.currentUser().aud[0]}),M.value.code==200){let s=M.value.data;if(console.log(s),await u.makePayment(e.value),M.value.code==200){let S=e.value.period.hasOwnProperty("to"),y={tenantId:k.currentUser().aud[0],reservationId:s};S?(y.startDate=e.value.period.from,y.endDate=e.value.period.to):y.startDate=e.value.period,await u.rentProperty(String(e.value.objectId),y),M.value.code==200?await ee.push("/pay-done"):E()}else E()}else E()}function E(){u.repopulatePayment(JSON.parse(sessionStorage.getItem("tempPay"))),V.value=!0}function ie(l){sessionStorage.removeItem("tempPay"),e.value.paymentMethod=l,u.clearFormData(l)}function ue(l){const o=l.keyCode||l.which;/[0-9]/.test(String.fromCharCode(o))&&l.preventDefault()}return fe(async()=>{await re()}),(l,o)=>(p(),x(L,null,[a(Se,{class:"q-mx-xl"},{default:r(()=>[t("div",Ae,[a(q,{bordered:"",flat:"",class:"col-xl-7 col-lg-7 col-md-12 col-sm-12 col-xs-12 q-px-lg q-py-md"},{default:r(()=>[$e,a(Q),t("div",Ee,[he(t("div",null,n(h.value),513),[[be,!1]]),Re]),t("div",Ue,[a(q,{bordered:"",flat:"",class:"col-xl-4 col-lg-6 col-md-12 col-sm-6 col-xs-12 q-px-sm cursor-pointer"},{default:r(()=>[t("div",Te,[Ne,a(_),a(g,{size:"20px",name:"edit_note"})]),t("div",null,[t("h1",ze,n(ne.value)+" ",1)]),a(K,null,{default:r(()=>[t("div",Ye,[a(J,{flat:"",color:"warning",mask:"YYYY-MM-DD HH:mm:ss",modelValue:e.value.period,"onUpdate:modelValue":o[0]||(o[0]=s=>e.value.period=s),range:""},null,8,["modelValue"])])]),_:1})]),_:1}),a(q,{bordered:"",flat:"",class:"col-xl-4 col-lg-6 col-md-12 col-sm-6 col-xs-12 q-px-sm cursor-pointer"},{default:r(()=>[t("div",Fe,[Be,a(_),a(g,{size:"20px",name:"edit_note"})]),t("div",null,[t("h1",He,n(O.value-e.value.noOfInfants>1?`${O.value-e.value.noOfInfants} Guests`:`${O.value-e.value.noOfInfants} Guest`)+" "+n(e.value.noOfInfants>1?`${e.value.noOfInfants} Infants`:`${e.value.noOfInfants} Infant`),1)]),a(K,{class:"q-pa-lg",style:{width:"30%"}},{default:r(()=>[t("div",je,[Le,t("div",Ge,[t("div",We,[a(v,{flat:"",outline:"",round:"",size:"18px",icon:"remove_circle_outline",onClick:o[1]||(o[1]=s=>B(!1)),class:"text-grey"}),t("span",Je,n(e.value.noOfAdults==null?0:e.value.noOfAdults),1),a(v,{flat:"",outline:"",round:"",size:"18px",onClick:o[2]||(o[2]=s=>B(!0)),icon:"add_circle_outline",class:"text-grey"})])])]),t("div",Ke,[Ze,t("div",Xe,[t("div",et,[a(v,{flat:"",outline:"",round:"",size:"18px",onClick:o[3]||(o[3]=s=>H(!1)),icon:"remove_circle_outline",class:"text-grey"}),t("span",tt,n(e.value.noOfChildren==null?0:e.value.noOfChildren),1),a(v,{flat:"",outline:"",round:"",size:"18px",onClick:o[4]||(o[4]=s=>H(!0)),icon:"add_circle_outline",class:"text-grey"})])])]),t("div",ot,[at,t("div",lt,[t("div",st,[a(v,{flat:"",outline:"",round:"",size:"18px",onClick:o[5]||(o[5]=s=>j(!1)),icon:"remove_circle_outline",class:"text-grey"}),t("span",nt,n(e.value.noOfInfants==null?0:e.value.noOfInfants),1),a(v,{flat:"",outline:"",round:"",size:"18px",onClick:o[6]||(o[6]=s=>j(!0)),icon:"add_circle_outline",class:"text-grey"})])])])]),_:1})]),_:1})]),rt,a(Q,{style:{width:"10%"}}),t("div",dt,[t("div",it,[a(v,{push:"","icon-right":"wallet","no-caps":"",rounded:"",modelValue:e.value.paymentMethod,"onUpdate:modelValue":o[7]||(o[7]=s=>e.value.paymentMethod=s),label:"Mobile Money",class:xe({"custom-button":N.value,"q-mx-xs":!N.value}),onClick:o[8]||(o[8]=s=>ie("MobileMoney"))},null,8,["modelValue","class"]),G("",!0)])]),a(Me,{onSubmit:de},{default:r(()=>[e.value.paymentMethod=="MobileMoney"?(p(),x("div",ut,[t("div",ct,[a(De,{outlined:"",rounded:"",clearable:"",color:"grey",label:"Telecom",options:["MTN","AIRTEL"],rules:[oe],modelValue:e.value.mobilePayment.issuer,"onUpdate:modelValue":o[11]||(o[11]=s=>e.value.mobilePayment.issuer=s)},null,8,["rules","modelValue"])]),t("div",mt,[a(w,{outlined:"",rounded:"",color:"grey",label:"Phone Number",placeholder:"256 700-000-000",mask:"(###) ### - ### - ###",rules:[A],modelValue:e.value.mobilePayment.phone,"onUpdate:modelValue":o[12]||(o[12]=s=>e.value.mobilePayment.phone=s)},null,8,["rules","modelValue"])])])):(p(),x("div",vt,[t("div",pt,[t("div",yt,[a(Z,{modelValue:e.value.cardPayment.issuer,"onUpdate:modelValue":o[13]||(o[13]=s=>e.value.cardPayment.issuer=s),val:"VISA",label:"Visa Card",color:"warning"},null,8,["modelValue"]),a(Z,{modelValue:e.value.cardPayment.issuer,"onUpdate:modelValue":o[14]||(o[14]=s=>e.value.cardPayment.issuer=s),val:"MASTER_CARD",label:"Master Card",color:"warning"},null,8,["modelValue"])])]),t("div",_t,[a(w,{outlined:"",rounded:"",color:"grey",label:"Card Number",rules:[z],mask:"#### #### #### ####",modelValue:e.value.cardPayment.cardNumber,"onUpdate:modelValue":o[15]||(o[15]=s=>e.value.cardPayment.cardNumber=s)},null,8,["rules","modelValue"])]),t("div",ft,[a(w,{outlined:"",rounded:"",color:"grey",label:"Card holder",type:"text",onKeydown:ue,rules:[Y],modelValue:e.value.cardPayment.cardHolder,"onUpdate:modelValue":o[16]||(o[16]=s=>e.value.cardPayment.cardHolder=s)},null,8,["rules","modelValue"])]),t("div",ht,[a(w,{rounded:"",outlined:"",color:"grey",clearable:"",readonly:"",rules:[F],modelValue:e.value.cardPayment.expiryDate,"onUpdate:modelValue":o[19]||(o[19]=s=>e.value.cardPayment.expiryDate=s),label:"Expiration date"},{append:r(()=>[a(g,{name:"event",class:"cursor-pointer"},{default:r(()=>[a(Ve,{ref:"expiration","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[a(J,{modelValue:e.value.cardPayment.expiryDate,"onUpdate:modelValue":[o[17]||(o[17]=s=>e.value.cardPayment.expiryDate=s),o[18]||(o[18]=s=>l.$refs.expiration.hide())],"first-day-of-week":"1",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["rules","modelValue"])]),t("div",xt,[a(w,{outlined:"",rounded:"",color:"grey",label:"CVC",mask:"###",rules:[le],modelValue:e.value.cardPayment.cvc,"onUpdate:modelValue":o[20]||(o[20]=s=>e.value.cardPayment.cvc=s)},null,8,["rules","modelValue"])])])),t("div",gt,[t("div",bt,[a(w,{outlined:"",rounded:"",color:"grey",label:"Write a few sentences about yourself",type:"textarea",rules:[$],modelValue:e.value.description,"onUpdate:modelValue":o[21]||(o[21]=s=>e.value.description=s)},null,8,["rules","modelValue"])])]),t("div",qt,[a(v,{rounded:"","no-caps":"",color:"purple",label:"Confirm and pay",class:"q-px-md",type:"submit",loading:te.value},null,8,["loading"])])]),_:1})]),_:1}),a(q,{flat:"",bordered:"",class:"col-xl-4 col-lg-4 col-md-12 col-sm-12 col-xs-12",style:{height:"50%"}},{default:r(()=>[a(U,{horizontal:""},{default:r(()=>[a(U,{class:"col-5"},{default:r(()=>[a(Ce,{ratio:1,class:"rounded-borders",src:C.value.images.filter(s=>s.coverImage===!0)[0].uri},null,8,["src"])]),_:1}),a(U,{class:"q-pt-xs"},{default:r(()=>{var s,S,y;return[t("div",wt,n((s=C.value)==null?void 0:s.propertyType),1),t("div",Pt,n((S=C.value)==null?void 0:S.name),1),t("div",Ct,[(p(!0),x(L,null,ge((y=C.value)==null?void 0:y.features,c=>(p(),x("div",null,[c.feature=="FEATURE_BATH_ROOMS"||c.feature=="FEATURE_BED_ROOMS"||c.feature=="FEATURE_SQUARE_METERS"?(p(),x("div",Dt,[a(g,{name:b(m).featureIcon(c.feature),size:"15px"},null,8,["name"]),f(" "+n(c.value)+" "+n(c.feature=="FEATURE_SQUARE_METERS"?"Sq.Ft ":c.feature=="FEATURE_BED_ROOMS"?"beds":"baths"),1)])):G("",!0)]))),256))]),a(Q,{class:"q-my-md",style:{width:"20%"}}),t("div",Vt,[b(m).computeAverageRating(I.value==null?[]:I.value)>0?(p(),W(Ie,{key:0,"checked-icon":"star","unchecked-icon":"star","indeterminate-icon":"star",color:"warning",class:"no-margin","model-value":""},{default:r(()=>{var c;return[f(n(b(m).computeAverageRating(I.value))+" ",1),t("span",Mt,"("+n((c=I.value)==null?void 0:c.length)+")",1)]}),_:1})):(p(),W(g,{key:1,name:"star_border",size:"20px"})),f(" None ")])]}),_:1})]),_:1}),It,t("div",St,[t("div",Qt,[t("span",kt,n(e.value.amount.currencyCode),1),f(" "+n(b(m).commaSeparate(e.value.amount.units))+" x "+n(h.value>1?`${h.value} ${e.value.chargeCycle}s`:`${h.value} ${e.value.chargeCycle}`),1)]),a(_),t("div",Ot,n(e.value.currency)+" "+n(b(m).commaSeparateWithDecimal(e.value.amount.units*h.value,1)),1)]),t("div",At,[$t,a(_),t("div",Et,n(e.value.amount.currencyCode)+" "+n(e.value.vatAmount.units)+"."+n(e.value.vatAmount.nanos),1)]),t("div",Rt,[Ut,a(_),t("div",Tt,n(e.value.amount.currencyCode)+" "+n(e.value.charge.units)+"."+n(e.value.charge.nanos),1)]),a(Q,{inset:""}),t("div",Nt,[zt,a(_),t("div",Yt,n(e.value.amount.currencyCode)+" "+n(b(m).commaSeparateWithDecimal(e.value.amount.units*h.value+e.value.charge.units+e.value.vatAmount.units,1)),1)])]),_:1})])]),_:1}),a(Qe,{modelValue:V.value,"onUpdate:modelValue":o[23]||(o[23]=s=>V.value=s),persistent:""},{default:r(()=>[a(q,{class:"q-pa-sm"},{default:r(()=>[t("div",Ft,[a(g,{color:"negative",name:"error",class:"q-mr-sm",size:"50px"}),Bt,a(_),t("div",Ht,[a(v,{flat:"",round:"",icon:"close",onClick:o[22]||(o[22]=s=>V.value=!1)})])]),a(q,{bordered:"",flat:"",class:"q-my-md"},{default:r(()=>[jt]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});var Vo=ce(Lt,[["__scopeId","data-v-c063206e"]]);export{Vo as default};
