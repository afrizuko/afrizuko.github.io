import{Q as O}from"./QSeparator.9b09cdb2.js";import{Q as g}from"./QSpace.4d08d001.js";import{_ as we,d as Ce,r as T,aS as Ve,u as Me,aa as De,k as ke,c,o as Se,m as b,v as V,f as a,p as r,F as re,q as t,A as Qe,z as n,C as M,Q as q,t as E,x as Ie,B as w,s as C,n as de,ay as $e,D as Ae,E as Oe}from"./index.29cc8f67.js";import{Q as ce,d as Ee}from"./QDate.4bf8ad71.js";import{Q as ie}from"./QMenu.38ee760d.js";import{Q as D}from"./QCard.2ae7f71b.js";import{Q as Ne}from"./QImg.5eac1bcc.js";import"./QSelect.c258c1b4.js";import{Q as S}from"./QInput.4ec71da6.js";import{Q as me}from"./QRadio.ab75588f.js";import{Q as Re}from"./QPopupProxy.3f8bbaa9.js";import{Q as Te}from"./QForm.1518d88d.js";import{Q as U}from"./QCardSection.8ed9cf69.js";import{Q as Ue}from"./QCheckbox.777f4100.js";import{Q as Be}from"./QPage.4ee3a514.js";import{Q as ze}from"./QDialog.5ed25613.js";import{u as Ye}from"./payment.8eaab4ec.js";import{m as ue}from"./moment.18ddbc39.js";import{u as Fe}from"./property.061c8fe0.js";import"./use-dark.f934fa20.js";import"./use-cache.b0833c75.js";import"./use-form.286392dd.js";import"./format.c860d4da.js";import"./position-engine.9cabe4fb.js";import"./selection.f6d0c368.js";import"./use-timeout.1cfdbf42.js";import"./focus-manager.b507780d.js";import"./scroll.1c2dbad9.js";import"./use-prevent-scroll.74d0c0a7.js";import"./QChip.8303e392.js";import"./QItem.15492546.js";import"./QItemSection.52be14ae.js";import"./QItemLabel.6e93fea8.js";import"./rtl.b51694b1.js";import"./uid.42677368.js";import"./use-checkbox.a4f3c2b5.js";const d=Q=>(Ae("data-v-7f9da0c2"),Q=Q(),Oe(),Q),He={class:"row justify-between q-mt-xl"},je=d(()=>t("div",{class:"row"},[t("h1",{class:"text-weight-bold text-h4"}," Confirm reservation ")],-1)),Le={class:"row"},We=d(()=>t("h1",{class:"text-weight-bold text-h5"}," Your Stay ",-1)),Je={class:"row q-mt-md"},Ke={class:"row q-mt-md"},Ze=d(()=>t("div",{class:"text-grey"}," Date ",-1)),Ge={class:"text-weight-bold text-h6"},Xe={class:"q-pa-md"},et={class:"row q-mt-md"},tt=d(()=>t("div",{class:"text-grey"}," Tenants ",-1)),ot={class:"text-weight-bold text-h6"},at={class:"row q-mx-md q-my-sm",style:{width:"400px"}},lt=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-6 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[C(" Adults "),t("h1",{class:"text-caption no-margin"},"Ages 13 or above")])],-1)),st={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},nt={class:"row"},rt={class:"q-mt-sm q-pa-sm"},dt={class:"row q-mx-md",style:{width:"400px"}},ct=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[C(" Children "),t("h1",{class:"text-caption no-margin"},"Ages 2-12")])],-1)),it={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},mt={class:"row"},ut={class:"q-mt-sm q-pa-sm"},vt={class:"row q-mx-md",style:{width:"400px"}},pt=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[C(" Infants "),t("h1",{class:"text-caption no-margin"},"Ages 0-2")])],-1)),_t={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},yt={class:"row"},ht={class:"q-mt-sm q-pa-sm"},ft=d(()=>t("div",{class:"row"},[t("h1",{class:"text-weight-bold text-h6"}," Say something about your self ")],-1));const xt={key:0,class:"row q-my-md"};const gt={key:1},bt={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-md"},qt={class:"q-gutter-sm"},Pt={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-sm q-px-sm"},wt={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-sm q-px-sm"},Ct={class:"col-sm-12 col-xs-12 col-lg-6 col-md-4 q-my-sm q-px-sm"},Vt={class:"col-sm-12 col-xs-12 col-lg-6 col-md-4 q-my-sm q-px-sm"},Mt={class:"row"},Dt={class:"col-sm-12 col-xs-12 col-lg-12 col-xl-8 col-md-4 q-px-sm"},kt={class:"row q-ma-sm"},St={class:"text-h7 q-mt-sm q-mb-xs text-grey"},Qt={class:"text-h7 q-mt-sm q-mb-xs"},It={class:"row justify-between q-mt-md"},$t={key:0,class:"q-mr-sm"},At={class:"q-mt-md"},Ot={class:"text-grey"},Et=d(()=>t("div",{class:"row"},[t("div",{class:"text-h5 q-mt-sm q-mb-xs q-ml-md"}," Price detail ")],-1)),Nt={class:"row q-mx-lg q-mt-md q-mb-sm"},Rt={class:"text-grey"},Tt={style:{"font-size":"0.8em",color:"#ff0000"}},Ut={class:"text-grey"},Bt={class:"row q-mx-lg q-mb-sm"},zt=d(()=>t("div",{class:"text-grey"}," VAT ",-1)),Yt={class:"text-grey"},Ft={class:"row q-mx-lg q-mb-md"},Ht=d(()=>t("div",{class:"text-grey"}," Service charge ",-1)),jt={class:"text-grey"},Lt={class:"row q-mx-lg q-mb-md"},Wt=d(()=>t("div",{class:"text-grey"}," Security charge ",-1)),Jt={class:"text-grey"},Kt={class:"row q-mx-lg q-ma-md"},Zt=d(()=>t("div",{class:"text-subtitle1"}," Total ",-1)),Gt={class:"text-subtitle1"},Xt={class:"row"},eo=d(()=>t("div",null,[t("p",{class:"text-h6 text-negative q-mt-sm"}," Transaction Failed ")],-1)),to={class:"q-dialog__header"},oo=d(()=>t("div",{class:"row q-mb-md q-pa-md"},[t("p",null,"Whoops! Your transaction didn't go through. Please double-check your payment details and try again")],-1)),ao=Ce({__name:"checkout",setup(Q){T(null),Ve();const ve=Me(),i=De(),v=Ye(),k=Fe(),B=ke(),I=T(!1),z=T("31/12/2023");c(()=>{const l=z.value.split("/"),o=Date.parse(`${l[2]}-${l[1]}-${l[0]}`);return`${z.value} (${o})`});const e=c(()=>v.getPaymentDetails),N=c(()=>e.value.noOfInfants+e.value.noOfChildren+e.value.noOfAdults),P=c(()=>{if(e.value.period.from!=null){const l=ue(e.value.period.from);return ue(e.value.period.to).diff(l,"months")+1}else return 1});c(()=>k.getPropertyRating),c(()=>k.getImages);const p=c(()=>k.getProperty),pe=c(()=>v.isLoading),_e=c(()=>v.getResponse),lo=c(()=>e.value.paymentMethod=="MobileMoney"),$=c(()=>{var l,o;return(o=k.getPropertyReviews[(l=p.value)==null?void 0:l.id])==null?void 0:o.reviews}),Y=l=>l&&l.replace(/[()\s\-]/g,"").length===12||"Phone Number must be 12 characters",ye=()=>Y(e.value.mobilePayment.telecom)&&Y(e.value.mobilePayment.phone),F=l=>l&&l.replace(/\s/g,"").length==16||"Card must be 16 characters",H=l=>l&&l.length!=0||"Card holder name is required",R=l=>l&&l.length!=0||"Description is required",he=l=>l&&l.length==3||"CVC must be 3 characters",j=l=>{const o=Ee.formatDate(new Date,"DD/MM/YYYY");return l&&l>o||"Please select a future date"},fe=()=>F(e.value.cardPayment.cardNumber)&&H(e.value.cardPayment.cardHolder)&&j(e.value.cardPayment.expiryDate)&&R(e.value.description)&&R(e.value.cardPayment.cvc),xe=c(()=>e.value.period.hasOwnProperty("from")?`${i.formatDateMonthDay(e.value.period.from)} -
    ${i.formatDateMonthDay(e.value.period.to)}`:i.formatStartDate(e.value.period));function L(l){v.noOfAdults(l)}function W(l){v.noOfChildren(l)}function J(l){v.noOfInfants(l)}async function ge(){var o;let l={objectType:"PROPERTY",objectIds:[(o=e.value)==null?void 0:o.objectId]};await k.findPropertyImages(l)}async function be(){var l,o,s,_,y,h,f,x;if(e.value.paymentMethod=="MobileMoney"?ye():fe()){e.value.paymentMethod==="DebitCard"?(e.value.cardPayment.cardNumber=String((l=e.value.cardPayment.cardNumber)==null?void 0:l.replace(/\s/g,"")),e.value.cardPayment.expiryDate=e.value.cardPayment.expiryDate+"T00:00:00Z"):e.value.mobilePayment.phone=String((o=e.value.mobilePayment.phone)==null?void 0:o.replace(/[()\s\-]/g,"")),e.value.userId=B.currentUser().aud[0],sessionStorage.setItem("tempPay",JSON.stringify(e.value)),e.value.paymentMethod==="DebitCard"?delete e.value.mobilePayment:delete e.value.cardPayment;let m=((_=(s=e.value)==null?void 0:s.amount)==null?void 0:_.units)*P.value+(Number((y=e.value)==null?void 0:y.charge)+Number((h=e.value)==null?void 0:h.vatAmount))+Number((x=(f=p.value)==null?void 0:f.securityAmount)==null?void 0:x.units);await v.reserveProperty(String(e.value.objectId),{tenantId:B.currentUser().aud[0],initialDeposit:m}),_e.value.code==200?await ve.push("/pay-done"):qe()}}function qe(){v.repopulatePayment(JSON.parse(sessionStorage.getItem("tempPay"))),I.value=!0}function so(l){sessionStorage.removeItem("tempPay"),e.value.paymentMethod=l,v.clearFormData(l)}function Pe(l){const o=l.keyCode||l.which;/[0-9]/.test(String.fromCharCode(o))&&l.preventDefault()}return Se(async()=>{await ge()}),(l,o)=>(b(),V(re,null,[a(Be,{class:"q-mx-xl"},{default:r(()=>[t("div",He,[a(D,{bordered:"",flat:"",class:"col-xl-7 col-lg-7 col-md-12 col-sm-12 col-xs-12 q-px-lg q-py-md"},{default:r(()=>[je,a(O),t("div",Le,[Qe(t("div",null,n(P.value),513),[[$e,!1]]),We]),t("div",Je,[a(D,{bordered:"",flat:"",class:"col-xl-4 col-lg-6 col-md-12 col-sm-6 col-xs-12 q-px-sm cursor-pointer"},{default:r(()=>[t("div",Ke,[Ze,a(g),a(M,{size:"20px",name:"edit_note"})]),t("div",null,[t("h1",Ge,n(xe.value),1)]),a(ie,null,{default:r(()=>[t("div",Xe,[a(ce,{flat:"",color:"warning",mask:"YYYY-MM-DD HH:mm:ss",modelValue:e.value.period,"onUpdate:modelValue":o[0]||(o[0]=s=>e.value.period=s),range:""},null,8,["modelValue"])])]),_:1})]),_:1}),a(D,{bordered:"",flat:"",class:"col-xl-4 col-lg-6 col-md-12 col-sm-6 col-xs-12 q-px-sm cursor-pointer"},{default:r(()=>{var s,_,y,h,f,x;return[t("div",et,[tt,a(g),a(M,{size:"20px",name:"edit_note"})]),t("div",null,[t("h1",ot,n(N.value-((s=e.value)==null?void 0:s.noOfInfants)>1?`${N.value-((_=e.value)==null?void 0:_.noOfInfants)} Tenants`:`${N.value-((y=e.value)==null?void 0:y.noOfInfants)} Tenant`)+" "+n(((h=e.value)==null?void 0:h.noOfInfants)>1?`${(f=e.value)==null?void 0:f.noOfInfants} Infants`:`${(x=e.value)==null?void 0:x.noOfInfants} Infant`),1)]),a(ie,{class:"q-pa-lg",style:{width:"30%"}},{default:r(()=>[t("div",at,[lt,t("div",st,[t("div",nt,[a(q,{flat:"",outline:"",round:"",size:"18px",icon:"remove_circle_outline",onClick:o[1]||(o[1]=m=>L(!1)),class:"text-grey"}),t("span",rt,n(e.value.noOfAdults==null?0:e.value.noOfAdults),1),a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[2]||(o[2]=m=>L(!0)),icon:"add_circle_outline",class:"text-grey"})])])]),t("div",dt,[ct,t("div",it,[t("div",mt,[a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[3]||(o[3]=m=>W(!1)),icon:"remove_circle_outline",class:"text-grey"}),t("span",ut,n(e.value.noOfChildren==null?0:e.value.noOfChildren),1),a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[4]||(o[4]=m=>W(!0)),icon:"add_circle_outline",class:"text-grey"})])])]),t("div",vt,[pt,t("div",_t,[t("div",yt,[a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[5]||(o[5]=m=>J(!1)),icon:"remove_circle_outline",class:"text-grey"}),t("span",ht,n(e.value.noOfInfants==null?0:e.value.noOfInfants),1),a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[6]||(o[6]=m=>J(!0)),icon:"add_circle_outline",class:"text-grey"})])])])]),_:1})]}),_:1})]),ft,a(O,{style:{width:"10%"}}),E("",!0),a(Te,{onSubmit:be},{default:r(()=>[e.value.paymentMethod=="MobileMoney"?(b(),V("div",xt,[E("",!0),E("",!0)])):(b(),V("div",gt,[t("div",bt,[t("div",qt,[a(me,{modelValue:e.value.cardPayment.issuer,"onUpdate:modelValue":o[13]||(o[13]=s=>e.value.cardPayment.issuer=s),val:"VISA",label:"Visa Card",color:"warning"},null,8,["modelValue"]),a(me,{modelValue:e.value.cardPayment.issuer,"onUpdate:modelValue":o[14]||(o[14]=s=>e.value.cardPayment.issuer=s),val:"MASTER_CARD",label:"Master Card",color:"warning"},null,8,["modelValue"])])]),t("div",Pt,[a(S,{outlined:"",rounded:"",color:"grey",label:"Card Number",rules:[F],mask:"#### #### #### ####",modelValue:e.value.cardPayment.cardNumber,"onUpdate:modelValue":o[15]||(o[15]=s=>e.value.cardPayment.cardNumber=s)},null,8,["rules","modelValue"])]),t("div",wt,[a(S,{outlined:"",rounded:"",color:"grey",label:"Card holder",type:"text",onKeydown:Pe,rules:[H],modelValue:e.value.cardPayment.cardHolder,"onUpdate:modelValue":o[16]||(o[16]=s=>e.value.cardPayment.cardHolder=s)},null,8,["rules","modelValue"])]),t("div",Ct,[a(S,{rounded:"",outlined:"",color:"grey",clearable:"",readonly:"",rules:[j],modelValue:e.value.cardPayment.expiryDate,"onUpdate:modelValue":o[19]||(o[19]=s=>e.value.cardPayment.expiryDate=s),label:"Expiration date"},{append:r(()=>[a(M,{name:"event",class:"cursor-pointer"},{default:r(()=>[a(Re,{ref:"expiration","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[a(ce,{modelValue:e.value.cardPayment.expiryDate,"onUpdate:modelValue":[o[17]||(o[17]=s=>e.value.cardPayment.expiryDate=s),o[18]||(o[18]=s=>l.$refs.expiration.hide())],"first-day-of-week":"1",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["rules","modelValue"])]),t("div",Vt,[a(S,{outlined:"",rounded:"",color:"grey",label:"CVC",mask:"###",rules:[he],modelValue:e.value.cardPayment.cvc,"onUpdate:modelValue":o[20]||(o[20]=s=>e.value.cardPayment.cvc=s)},null,8,["rules","modelValue"])])])),t("div",Mt,[t("div",Dt,[a(S,{outlined:"",rounded:"",color:"grey",label:"Write a few sentences about yourself",type:"textarea",rules:[R],modelValue:e.value.description,"onUpdate:modelValue":o[21]||(o[21]=s=>e.value.description=s)},null,8,["rules","modelValue"])])]),t("div",kt,[a(q,{rounded:"","no-caps":"",color:"purple",label:"Confirm reservation",class:"q-px-md",type:"submit",loading:pe.value},null,8,["loading"])])]),_:1})]),_:1}),a(D,{flat:"",bordered:"",class:"col-xl-4 col-lg-4 col-md-12 col-sm-12 col-xs-12",style:{height:"50%"}},{default:r(()=>{var s,_,y,h,f,x,m,K,Z,G,X,ee,te,oe,ae,le;return[a(U,{horizontal:""},{default:r(()=>[a(U,{class:"col-5"},{default:r(()=>[a(Ne,{ratio:1,class:"rounded-borders",src:p.value.images.filter(A=>A.coverImage===!0)[0].uri},null,8,["src"])]),_:1}),a(U,{class:"q-pt-xs"},{default:r(()=>{var A,se,ne;return[t("div",St,n((A=p.value)==null?void 0:A.propertyType),1),t("div",Qt,n((se=p.value)==null?void 0:se.name),1),t("div",It,[(b(!0),V(re,null,Ie((ne=p.value)==null?void 0:ne.features,u=>(b(),V("div",null,[u.feature=="FEATURE_BATH_ROOMS"||u.feature=="FEATURE_BED_ROOMS"||u.feature=="FEATURE_SQUARE_METERS"?(b(),V("div",$t,[a(M,{name:w(i).featureIcon(u.feature),size:"15px"},null,8,["name"]),C(" "+n(u.value)+" "+n(u.feature=="FEATURE_SQUARE_METERS"?"Sq.Ft ":u.feature=="FEATURE_BED_ROOMS"?"beds":"baths"),1)])):E("",!0)]))),256))]),a(O,{class:"q-my-md",style:{width:"20%"}}),t("div",At,[w(i).computeAverageRating($.value==null?[]:$.value)>0?(b(),de(Ue,{key:0,"checked-icon":"star","unchecked-icon":"star","indeterminate-icon":"star",color:"warning",class:"no-margin","model-value":""},{default:r(()=>{var u;return[C(n(w(i).computeAverageRating($.value))+" ",1),t("span",Ot,"("+n((u=$.value)==null?void 0:u.length)+")",1)]}),_:1})):(b(),de(M,{key:1,name:"star_border",size:"20px"})),C(" None ")])]}),_:1})]),_:1}),Et,t("div",Nt,[t("div",Rt,[t("span",Tt,n(e.value.amount.currencyCode),1),C(" "+n(w(i).commaSeparate(e.value.amount.units))+" x "+n(P.value>1?`${P.value} ${e.value.chargeCycle}s`:`${P.value} ${e.value.chargeCycle}`),1)]),a(g),t("div",Ut,n(e.value.currency)+" "+n(w(i).commaSeparateWithDecimal(e.value.amount.units*P.value,1)),1)]),t("div",Bt,[zt,a(g),t("div",Yt,n((_=(s=e.value)==null?void 0:s.amount)==null?void 0:_.currencyCode)+" "+n((y=e.value)==null?void 0:y.vatAmount),1)]),t("div",Ft,[Ht,a(g),t("div",jt,n((f=(h=e.value)==null?void 0:h.amount)==null?void 0:f.currencyCode)+" "+n((x=e.value)==null?void 0:x.charge),1)]),t("div",Lt,[Wt,a(g),t("div",Jt,n((K=(m=p.value)==null?void 0:m.securityAmount)==null?void 0:K.currencyCode)+" "+n(w(i).commaSeparate((G=(Z=p.value)==null?void 0:Z.securityAmount)==null?void 0:G.units)),1)]),a(O,{inset:""}),t("div",Kt,[Zt,a(g),t("div",Gt,n(e.value.amount.currencyCode)+" "+n(w(i).commaSeparateWithDecimal(((ee=(X=e.value)==null?void 0:X.amount)==null?void 0:ee.units)*P.value+((te=e.value)==null?void 0:te.charge)+((oe=e.value)==null?void 0:oe.vatAmount)+Number((le=(ae=p.value)==null?void 0:ae.securityAmount)==null?void 0:le.units),1)),1)])]}),_:1})])]),_:1}),a(ze,{modelValue:I.value,"onUpdate:modelValue":o[23]||(o[23]=s=>I.value=s),persistent:""},{default:r(()=>[a(D,{class:"q-pa-sm"},{default:r(()=>[t("div",Xt,[a(M,{color:"negative",name:"error",class:"q-mr-sm",size:"50px"}),eo,a(g),t("div",to,[a(q,{flat:"",round:"",icon:"close",onClick:o[22]||(o[22]=s=>I.value=!1)})])]),a(D,{bordered:"",flat:"",class:"q-my-md"},{default:r(()=>[oo]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});var Fo=we(ao,[["__scopeId","data-v-7f9da0c2"]]);export{Fo as default};
