import{Q as O}from"./QSeparator.141d3b5d.js";import{Q as g}from"./QSpace.793954d4.js";import{_ as qe,d as Pe,r as U,aS as we,u as Ce,aa as Ve,k as Me,c as i,o as De,m as b,v as V,f as a,p as r,F as le,q as t,A as ke,z as n,C as M,Q as q,t as E,x as Se,B as w,s as C,n as ne,ay as Qe,D as Ie,E as $e}from"./index.fed07d25.js";import{Q as re,d as Ae}from"./QDate.55ef3d05.js";import{Q as de}from"./QMenu.6ce48952.js";import{Q as D}from"./QCard.8dd24b16.js";import{Q as Oe}from"./QImg.1e913361.js";import"./QSelect.5fd40431.js";import{Q as S}from"./QInput.3b591ed0.js";import{Q as ie}from"./QRadio.0cec947b.js";import{Q as Ee}from"./QPopupProxy.00e49c97.js";import{Q as Ne}from"./QForm.3bb3ca91.js";import{Q as T}from"./QCardSection.258f71b9.js";import{Q as Re}from"./QCheckbox.095eae22.js";import{Q as Ue}from"./QPage.a2778391.js";import{Q as Te}from"./QDialog.a8299bf7.js";import{u as Be}from"./payment.b2ac607a.js";import{m as ce}from"./moment.18ddbc39.js";import{u as ze}from"./property.6b084a55.js";import"./use-dark.35ad09a7.js";import"./use-cache.b0833c75.js";import"./use-form.9377b251.js";import"./format.c860d4da.js";import"./position-engine.b62a05cf.js";import"./use-timeout.7a3d49e4.js";import"./focus-manager.b507780d.js";import"./scroll.59255f11.js";import"./use-prevent-scroll.1da4f1e0.js";import"./QChip.ddc19688.js";import"./QItem.b5dfa56e.js";import"./QItemSection.83a4db19.js";import"./QItemLabel.481932a1.js";import"./rtl.b51694b1.js";import"./uid.42677368.js";import"./use-checkbox.6368eecd.js";const d=Q=>(Ie("data-v-03dde8b4"),Q=Q(),$e(),Q),Ye={class:"row justify-between q-mt-xl"},Fe=d(()=>t("div",{class:"row"},[t("h1",{class:"text-weight-bold text-h4"}," Confirm reservation ")],-1)),He={class:"row"},je=d(()=>t("h1",{class:"text-weight-bold text-h5"}," Your Stay ",-1)),Le={class:"row q-mt-md"},We={class:"row q-mt-md"},Ge=d(()=>t("div",{class:"text-grey"}," Date ",-1)),Je={class:"text-weight-bold text-h6"},Xe={class:"q-pa-md"},Ke={class:"row q-mt-md"},Ze=d(()=>t("div",{class:"text-grey"}," Tenants ",-1)),et={class:"text-weight-bold text-h6"},tt={class:"row q-mx-md q-my-sm",style:{width:"400px"}},ot=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-6 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[C(" Adults "),t("h1",{class:"text-caption no-margin"},"Ages 13 or above")])],-1)),at={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},st={class:"row"},lt={class:"q-mt-sm q-pa-sm"},nt={class:"row q-mx-md",style:{width:"400px"}},rt=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[C(" Children "),t("h1",{class:"text-caption no-margin"},"Ages 2-12")])],-1)),dt={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},it={class:"row"},ct={class:"q-mt-sm q-pa-sm"},mt={class:"row q-mx-md",style:{width:"400px"}},ut=d(()=>t("div",{class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},[t("div",{class:"text-h6 q-mb-sm"},[C(" Infants "),t("h1",{class:"text-caption no-margin"},"Ages 0-2")])],-1)),vt={class:"col-xl-12 col-lg-6 col-md-12 col-sm-12 col-xs-12"},pt={class:"row"},_t={class:"q-mt-sm q-pa-sm"},yt=d(()=>t("div",{class:"row"},[t("h1",{class:"text-weight-bold text-h6"}," Say something about your self ")],-1));const ht={key:0,class:"row q-my-md"};const ft={key:1},xt={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-md"},gt={class:"q-gutter-sm"},bt={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-sm q-px-sm"},qt={class:"col-sm-12 col-xs-12 col-lg-12 col-md-4 q-my-sm q-px-sm"},Pt={class:"col-sm-12 col-xs-12 col-lg-6 col-md-4 q-my-sm q-px-sm"},wt={class:"col-sm-12 col-xs-12 col-lg-6 col-md-4 q-my-sm q-px-sm"},Ct={class:"row"},Vt={class:"col-sm-12 col-xs-12 col-lg-12 col-xl-8 col-md-4 q-px-sm"},Mt={class:"row q-ma-sm"},Dt={class:"text-h7 q-mt-sm q-mb-xs text-grey"},kt={class:"text-h7 q-mt-sm q-mb-xs"},St={class:"row justify-between q-mt-md"},Qt={key:0,class:"q-mr-sm"},It={class:"q-mt-md"},$t={class:"text-grey"},At=d(()=>t("div",{class:"row"},[t("div",{class:"text-h5 q-mt-sm q-mb-xs q-ml-md"}," Price detail ")],-1)),Ot={class:"row q-mx-lg q-mt-md q-mb-sm"},Et={class:"text-grey"},Nt={style:{"font-size":"0.8em",color:"#ff0000"}},Rt={class:"text-grey"},Ut={class:"row q-mx-lg q-mb-sm"},Tt=d(()=>t("div",{class:"text-grey"}," VAT ",-1)),Bt={class:"text-grey"},zt={class:"row q-mx-lg q-mb-md"},Yt=d(()=>t("div",{class:"text-grey"}," Service charge ",-1)),Ft={class:"text-grey"},Ht={class:"row q-mx-lg q-mb-md"},jt=d(()=>t("div",{class:"text-grey"}," Security charge ",-1)),Lt={class:"text-grey"},Wt={class:"row q-mx-lg q-ma-md"},Gt=d(()=>t("div",{class:"text-subtitle1"}," Total ",-1)),Jt={class:"text-subtitle1"},Xt={class:"row"},Kt=d(()=>t("div",null,[t("p",{class:"text-h6 text-negative q-mt-sm"}," Transaction Failed ")],-1)),Zt={class:"q-dialog__header"},eo=d(()=>t("div",{class:"row q-mb-md q-pa-md"},[t("p",null,"Whoops! Your transaction didn't go through. Please double-check your payment details and try again")],-1)),to=Pe({__name:"checkout",setup(Q){U(null),we();const me=Ce(),c=Ve(),v=Be(),k=ze(),B=Me(),I=U(!1),z=U("31/12/2023");i(()=>{const s=z.value.split("/"),o=Date.parse(`${s[2]}-${s[1]}-${s[0]}`);return`${z.value} (${o})`});const e=i(()=>v.getPaymentDetails),N=i(()=>e.value.noOfInfants+e.value.noOfChildren+e.value.noOfAdults),P=i(()=>{if(e.value.period.from!=null){const s=ce(e.value.period.from);return ce(e.value.period.to).diff(s,"months")+1}else return 1});i(()=>k.getPropertyRating),i(()=>k.getImages);const p=i(()=>k.getProperty),ue=i(()=>v.isLoading),ve=i(()=>v.getResponse),oo=i(()=>e.value.paymentMethod=="MobileMoney"),$=i(()=>{var s,o;return(o=k.getPropertyReviews[(s=p.value)==null?void 0:s.id])==null?void 0:o.reviews}),Y=s=>s&&s.replace(/[()\s\-]/g,"").length===12||"Phone Number must be 12 characters",pe=()=>Y(e.value.mobilePayment.telecom)&&Y(e.value.mobilePayment.phone),F=s=>s&&s.replace(/\s/g,"").length==16||"Card must be 16 characters",H=s=>s&&s.length!=0||"Card holder name is required",R=s=>s&&s.length!=0||"Description is required",_e=s=>s&&s.length==3||"CVC must be 3 characters",j=s=>{const o=Ae.formatDate(new Date,"DD/MM/YYYY");return s&&s>o||"Please select a future date"},ye=()=>F(e.value.cardPayment.cardNumber)&&H(e.value.cardPayment.cardHolder)&&j(e.value.cardPayment.expiryDate)&&R(e.value.description)&&R(e.value.cardPayment.cvc),he=i(()=>e.value.period.hasOwnProperty("from")?`${c.formatDateMonthDay(e.value.period.from)} -
    ${c.formatDateMonthDay(e.value.period.to)}`:c.formatStartDate(e.value.period));function L(s){v.noOfAdults(s)}function W(s){v.noOfChildren(s)}function G(s){v.noOfInfants(s)}async function fe(){var o;let s={objectType:"PROPERTY",objectIds:[(o=e.value)==null?void 0:o.objectId]};await k.findPropertyImages(s)}async function xe(){var s,o,l,_,y,h,f,x;if(e.value.paymentMethod=="MobileMoney"?pe():ye()){e.value.paymentMethod==="DebitCard"?(e.value.cardPayment.cardNumber=String((s=e.value.cardPayment.cardNumber)==null?void 0:s.replace(/\s/g,"")),e.value.cardPayment.expiryDate=e.value.cardPayment.expiryDate+"T00:00:00Z"):e.value.mobilePayment.phone=String((o=e.value.mobilePayment.phone)==null?void 0:o.replace(/[()\s\-]/g,"")),e.value.userId=B.currentUser().aud[0],sessionStorage.setItem("tempPay",JSON.stringify(e.value)),e.value.paymentMethod==="DebitCard"?delete e.value.mobilePayment:delete e.value.cardPayment;let m=((_=(l=e.value)==null?void 0:l.amount)==null?void 0:_.units)*P.value+(Number((y=e.value)==null?void 0:y.charge)+Number((h=e.value)==null?void 0:h.vatAmount))+Number((x=(f=p.value)==null?void 0:f.securityAmount)==null?void 0:x.units);await v.reserveProperty(String(e.value.objectId),{tenantId:B.currentUser().aud[0],initialDeposit:m}),ve.value.code==200?await me.push("/pay-done"):ge()}}function ge(){v.repopulatePayment(JSON.parse(sessionStorage.getItem("tempPay"))),I.value=!0}function ao(s){sessionStorage.removeItem("tempPay"),e.value.paymentMethod=s,v.clearFormData(s)}function be(s){const o=s.keyCode||s.which;/[0-9]/.test(String.fromCharCode(o))&&s.preventDefault()}return De(async()=>{await fe()}),(s,o)=>(b(),V(le,null,[a(Ue,{class:"q-mx-xl"},{default:r(()=>[t("div",Ye,[a(D,{bordered:"",flat:"",class:"col-xl-7 col-lg-7 col-md-12 col-sm-12 col-xs-12 q-px-lg q-py-md"},{default:r(()=>[Fe,a(O),t("div",He,[ke(t("div",null,n(P.value),513),[[Qe,!1]]),je]),t("div",Le,[a(D,{bordered:"",flat:"",class:"col-xl-4 col-lg-6 col-md-12 col-sm-6 col-xs-12 q-px-sm cursor-pointer"},{default:r(()=>[t("div",We,[Ge,a(g),a(M,{size:"20px",name:"edit_note"})]),t("div",null,[t("h1",Je,n(he.value),1)]),a(de,null,{default:r(()=>[t("div",Xe,[a(re,{flat:"",color:"warning",mask:"YYYY-MM-DD HH:mm:ss",modelValue:e.value.period,"onUpdate:modelValue":o[0]||(o[0]=l=>e.value.period=l),range:""},null,8,["modelValue"])])]),_:1})]),_:1}),a(D,{bordered:"",flat:"",class:"col-xl-4 col-lg-6 col-md-12 col-sm-6 col-xs-12 q-px-sm cursor-pointer"},{default:r(()=>{var l,_,y,h,f,x;return[t("div",Ke,[Ze,a(g),a(M,{size:"20px",name:"edit_note"})]),t("div",null,[t("h1",et,n(N.value-((l=e.value)==null?void 0:l.noOfInfants)>1?`${N.value-((_=e.value)==null?void 0:_.noOfInfants)} Tenants`:`${N.value-((y=e.value)==null?void 0:y.noOfInfants)} Tenant`)+" "+n(((h=e.value)==null?void 0:h.noOfInfants)>1?`${(f=e.value)==null?void 0:f.noOfInfants} Infants`:`${(x=e.value)==null?void 0:x.noOfInfants} Infant`),1)]),a(de,{class:"q-pa-lg",style:{width:"30%"}},{default:r(()=>[t("div",tt,[ot,t("div",at,[t("div",st,[a(q,{flat:"",outline:"",round:"",size:"18px",icon:"remove_circle_outline",onClick:o[1]||(o[1]=m=>L(!1)),class:"text-grey"}),t("span",lt,n(e.value.noOfAdults==null?0:e.value.noOfAdults),1),a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[2]||(o[2]=m=>L(!0)),icon:"add_circle_outline",class:"text-grey"})])])]),t("div",nt,[rt,t("div",dt,[t("div",it,[a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[3]||(o[3]=m=>W(!1)),icon:"remove_circle_outline",class:"text-grey"}),t("span",ct,n(e.value.noOfChildren==null?0:e.value.noOfChildren),1),a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[4]||(o[4]=m=>W(!0)),icon:"add_circle_outline",class:"text-grey"})])])]),t("div",mt,[ut,t("div",vt,[t("div",pt,[a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[5]||(o[5]=m=>G(!1)),icon:"remove_circle_outline",class:"text-grey"}),t("span",_t,n(e.value.noOfInfants==null?0:e.value.noOfInfants),1),a(q,{flat:"",outline:"",round:"",size:"18px",onClick:o[6]||(o[6]=m=>G(!0)),icon:"add_circle_outline",class:"text-grey"})])])])]),_:1})]}),_:1})]),yt,a(O,{style:{width:"10%"}}),E("",!0),a(Ne,{onSubmit:xe},{default:r(()=>[e.value.paymentMethod=="MobileMoney"?(b(),V("div",ht,[E("",!0),E("",!0)])):(b(),V("div",ft,[t("div",xt,[t("div",gt,[a(ie,{modelValue:e.value.cardPayment.issuer,"onUpdate:modelValue":o[13]||(o[13]=l=>e.value.cardPayment.issuer=l),val:"VISA",label:"Visa Card",color:"warning"},null,8,["modelValue"]),a(ie,{modelValue:e.value.cardPayment.issuer,"onUpdate:modelValue":o[14]||(o[14]=l=>e.value.cardPayment.issuer=l),val:"MASTER_CARD",label:"Master Card",color:"warning"},null,8,["modelValue"])])]),t("div",bt,[a(S,{outlined:"",rounded:"",color:"grey",label:"Card Number",rules:[F],mask:"#### #### #### ####",modelValue:e.value.cardPayment.cardNumber,"onUpdate:modelValue":o[15]||(o[15]=l=>e.value.cardPayment.cardNumber=l)},null,8,["rules","modelValue"])]),t("div",qt,[a(S,{outlined:"",rounded:"",color:"grey",label:"Card holder",type:"text",onKeydown:be,rules:[H],modelValue:e.value.cardPayment.cardHolder,"onUpdate:modelValue":o[16]||(o[16]=l=>e.value.cardPayment.cardHolder=l)},null,8,["rules","modelValue"])]),t("div",Pt,[a(S,{rounded:"",outlined:"",color:"grey",clearable:"",readonly:"",rules:[j],modelValue:e.value.cardPayment.expiryDate,"onUpdate:modelValue":o[19]||(o[19]=l=>e.value.cardPayment.expiryDate=l),label:"Expiration date"},{append:r(()=>[a(M,{name:"event",class:"cursor-pointer"},{default:r(()=>[a(Ee,{ref:"expiration","transition-show":"scale","transition-hide":"scale"},{default:r(()=>[a(re,{modelValue:e.value.cardPayment.expiryDate,"onUpdate:modelValue":[o[17]||(o[17]=l=>e.value.cardPayment.expiryDate=l),o[18]||(o[18]=l=>s.$refs.expiration.hide())],"first-day-of-week":"1",mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["rules","modelValue"])]),t("div",wt,[a(S,{outlined:"",rounded:"",color:"grey",label:"CVC",mask:"###",rules:[_e],modelValue:e.value.cardPayment.cvc,"onUpdate:modelValue":o[20]||(o[20]=l=>e.value.cardPayment.cvc=l)},null,8,["rules","modelValue"])])])),t("div",Ct,[t("div",Vt,[a(S,{outlined:"",rounded:"",color:"grey",label:"Write a few sentences about yourself",type:"textarea",rules:[R],modelValue:e.value.description,"onUpdate:modelValue":o[21]||(o[21]=l=>e.value.description=l)},null,8,["rules","modelValue"])])]),t("div",Mt,[a(q,{rounded:"","no-caps":"",color:"purple",label:"Confirm reservation",class:"q-px-md",type:"submit",loading:ue.value},null,8,["loading"])])]),_:1})]),_:1}),a(D,{flat:"",bordered:"",class:"col-xl-4 col-lg-4 col-md-12 col-sm-12 col-xs-12",style:{height:"50%"}},{default:r(()=>{var l,_,y,h,f,x,m,J,X,K,Z,ee,te,oe;return[a(T,{horizontal:""},{default:r(()=>[a(T,{class:"col-5"},{default:r(()=>[a(Oe,{ratio:1,class:"rounded-borders",src:p.value.images.filter(A=>A.coverImage===!0)[0].uri},null,8,["src"])]),_:1}),a(T,{class:"q-pt-xs"},{default:r(()=>{var A,ae,se;return[t("div",Dt,n((A=p.value)==null?void 0:A.propertyType),1),t("div",kt,n((ae=p.value)==null?void 0:ae.name),1),t("div",St,[(b(!0),V(le,null,Se((se=p.value)==null?void 0:se.features,u=>(b(),V("div",null,[u.feature=="FEATURE_BATH_ROOMS"||u.feature=="FEATURE_BED_ROOMS"||u.feature=="FEATURE_SQUARE_METERS"?(b(),V("div",Qt,[a(M,{name:w(c).featureIcon(u.feature),size:"15px"},null,8,["name"]),C(" "+n(u.value)+" "+n(u.feature=="FEATURE_SQUARE_METERS"?"Sq.Ft ":u.feature=="FEATURE_BED_ROOMS"?"bedrooms":"bathrooms"),1)])):E("",!0)]))),256))]),a(O,{class:"q-my-md",style:{width:"20%"}}),t("div",It,[w(c).computeAverageRating($.value==null?[]:$.value)>0?(b(),ne(Re,{key:0,"checked-icon":"star","unchecked-icon":"star","indeterminate-icon":"star",color:"warning",class:"no-margin","model-value":""},{default:r(()=>{var u;return[C(n(w(c).computeAverageRating($.value))+" ",1),t("span",$t,"("+n((u=$.value)==null?void 0:u.length)+")",1)]}),_:1})):(b(),ne(M,{key:1,name:"star_border",size:"20px"})),C(" None ")])]}),_:1})]),_:1}),At,t("div",Ot,[t("div",Et,[t("span",Nt,n(e.value.amount.currencyCode),1),C(" "+n(w(c).commaSeparate(e.value.amount.units))+" x "+n(P.value>1?`${P.value} ${e.value.chargeCycle}s`:`${P.value} ${e.value.chargeCycle}`),1)]),a(g),t("div",Rt,n(e.value.currency)+" "+n(w(c).commaSeparateWithDecimal(e.value.amount.units*P.value,1)),1)]),t("div",Ut,[Tt,a(g),t("div",Bt," UGX "+n((_=(l=e.value)==null?void 0:l.vatAmount)==null?void 0:_.units),1)]),t("div",zt,[Yt,a(g),t("div",Ft," UGX "+n((h=(y=e.value)==null?void 0:y.charge)==null?void 0:h.units),1)]),t("div",Ht,[jt,a(g),t("div",Lt,n((x=(f=p.value)==null?void 0:f.securityAmount)==null?void 0:x.currencyCode)+" "+n(w(c).commaSeparate((J=(m=p.value)==null?void 0:m.securityAmount)==null?void 0:J.units)),1)]),a(O,{inset:""}),t("div",Wt,[Gt,a(g),t("div",Jt,n(e.value.amount.currencyCode)+" "+n(w(c).commaSeparateWithDecimal(((K=(X=e.value)==null?void 0:X.amount)==null?void 0:K.units)*P.value+((Z=e.value)==null?void 0:Z.charge)+((ee=e.value)==null?void 0:ee.vatAmount)+Number((oe=(te=p.value)==null?void 0:te.securityAmount)==null?void 0:oe.units),1)),1)])]}),_:1})])]),_:1}),a(Te,{modelValue:I.value,"onUpdate:modelValue":o[23]||(o[23]=l=>I.value=l),persistent:""},{default:r(()=>[a(D,{class:"q-pa-sm"},{default:r(()=>[t("div",Xt,[a(M,{color:"negative",name:"error",class:"q-mr-sm",size:"50px"}),Kt,a(g),t("div",Zt,[a(q,{flat:"",round:"",icon:"close",onClick:o[22]||(o[22]=l=>I.value=!1)})])]),a(D,{bordered:"",flat:"",class:"q-my-md"},{default:r(()=>[eo]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});var Bo=qe(to,[["__scopeId","data-v-03dde8b4"]]);export{Bo as default};
